# 原理

# 环境简介

+ 所谓B/S模式(Browser/Server浏览器/服务器模式)，是指需要获取信息的用户使用浏览器向服务器发出请求，服务器对此做出响应，将有关信息发送给用户的浏览器。 
+ 在B/S模式中，服务器上必须有所谓的Web应用程序，服务器通过运行这些Web应用程序来响应用户的请求。因此，基于B/S模式的网络程序的核心就是设计服务器端的Web应用程序。
+ 一个服务器上可以有很多基于JSP的Web应用程序，以满足各种用户的需求。这些Web应用程序必须有一个软件来统一管理和运行，这样的软件被称作JSP引擎或JSP容器，而安装JSP引擎的计算机被称作一个支持JSP的Web服务器。
+ Tomcat是一个免费的开源JSP引擎，将安装了Tomcat的计算机称作一个Tomcat服务器。

## JSP运行原理

+ 当服务器上的一个JSP页面被第一次请求执行时，服务器上的JSP引擎首先将JSP页面文件转译成一个java文件，并编译这个java文件生成字节码文件，然后执行字节码文件响应客户的请求。
+ 把JSP页面中普通的HTML标记符号交给客户的浏览器执行显示。
+ 负责处理JSP标记,并将有关的处理结果发送到客户的浏览器。
+ 执行`<%`和`%>`之间的Java程序片（JSP页面中的动态部分），并把执行结果交给客户的浏览器显示。
+ 当多个客户请求一个JSP页面时，Tomcat服务器为每个客户启动一个线程，该线程负责执行常驻内存的字节码文件来响应相应客户的请求。这些线程由Tomcat服务器来管理，将CPU的使用权在各个线程之间快速切换，以保证每个线程都有机会执行字节码文件

![](https://img1.zlogs.net/20/20200505180233.png)







## Tomcat目录结构及其功能

+ bin：二进制执行文件。里面最常用的文件是startup.bat，如果是 Linux 或 Mac 系统启动文件为 startup.sh。
+ conf:配置目录。里面最核心的文件是server.xml。可以在里面改端口号等。默认端口号是8080，也就是说，此端口号不能被其他应用程序占用。
+ lib：库文件。tomcat运行时需要的jar包所在的目录
+ logs：日志
+ temp：临时产生的文件，即缓存
+ webapps：web的应用程序。web应用放置到此目录下浏览器可以直接访问
+ work：编译以后的class文件。





# JSP与Java Servlet的关系

+ Java Servlet是Java 语言的一部分，提供了用于服务器编程的API。Java Servlet就是编写在服务器端创建对象的Java类，习惯上称之为Servlet类，Servlet类的对象习惯上称之为一个servlet。
+  JSP技术就是以Java Servlet为基础，提供了Java Servlet的几乎所有好处，当客户请求一个JSP页面时，Tomcat服务器自动生成Java文件（如first1$jsp.java）、编译Java文件，并用编译得到的字节码文件在服务器端创建一个servlet。但是JSP技术不是Java Servlet技术的全部，它只是Java Servlet技术的一个成功应用。
+ 对于某些Web应用，就可能需要JSP+Javabean+servlet来完成，即需要服务器再创建一些servlet对象，配合JSP页面来完成整个Web应用程序的工作。







# 小结

+ JSP技术不仅是开发Web应用的先进技术，而且是进一步学习相关技术的基础。
+ JSP引擎是支持JSP程序的Web容器，负责运行JSP，并将有关结果发送到客户端。目前流行的JSP引擎之一是Tomcat。
+ 安装Tomcat服务器，首先要安装JDK，并需要设置Java_home环境变量。
+ JSP页面必须保存在Web服务目录中。Tomcat服务器的webapps下的目录都可以作为Web服务目录。如果想让webapps以外的其他的目录作为Web服务目录，必须要修改Tomcat服务器下conf文件夹中的server.xml文件，并重新启动Tomcat服务器。
+ 当服务器上的一个JSP页面被第一次请求执行时，服务器上的JSP引擎首先将JSP页面文件转译成一个Java文件，再将这个Java文件编译生成字节码文件，然后通过执行字节码文件响应客户的请求。
+ 当多个客户请求一个JSP页面时，Tomcat服务器为每个客户启动一个线程，该线程负责执行常驻内存的字节码文件来响应相应客户的请求。这些线程由Tomcat服务器来管理，将CPU的使用权在各个线程之间快速切换，以保证每个线程都有机会执行字节码文件。

















